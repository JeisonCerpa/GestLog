<Window x:Class="GestLog.Views.Tools.GestionEquipos.CrearPlanCronogramaDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:GestLog.Converters"
        Title="Crear Plan de Cronograma" Height="Auto" Width="600" MinHeight="500" MinWidth="500" 
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize" WindowStyle="SingleBorderWindow" Background="#FAFAFA" SizeToContent="Height">
    
    <Window.Resources>
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter" />
        <converters:InverseBooleanConverter x:Key="InverseBooleanConverter" />
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <converters:InverseBooleanToVisibilityConverter x:Key="InverseBooleanToVisibilityConverter" />
        <converters:BooleanToStringConverter x:Key="BooleanToStringConverter" />
    </Window.Resources>
    
    <Border Margin="16" Background="White" CornerRadius="8" Padding="20" BorderBrush="#DDD" BorderThickness="1">
        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <StackPanel>
                <TextBlock Text="Crear Plan de Cronograma" FontSize="20" FontWeight="Bold" Foreground="#118938" Margin="0,0,0,18"/>
                
                <!-- Información contextual -->
                <Border Background="#E8F5E8" BorderBrush="#118938" BorderThickness="1" CornerRadius="4" Padding="10" Margin="0,0,0,16">
                    <StackPanel>
                        <TextBlock Text="📅 Información de Semana Actual" FontWeight="Bold" Foreground="#118938" Margin="0,0,0,4"/>
                        <TextBlock x:Name="InfoSemanaTextBlock" Text="{Binding InfoSemanaActual}" Foreground="#555" FontSize="12"/>
                    </StackPanel>
                </Border>

                <Grid Margin="0,0,0,10">                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="140"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>                    <!-- Código del Equipo -->
                    <TextBlock Text="Código Equipo:*" Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" FontWeight="Bold"/>
                    <ComboBox Grid.Row="0" Grid.Column="1" Margin="0,4" Padding="8"
                              ItemsSource="{Binding EquiposDisponibles}"
                              SelectedItem="{Binding EquipoSeleccionado, UpdateSourceTrigger=PropertyChanged}"
                              DisplayMemberPath="DisplayText"
                              IsEditable="True"
                              Text="{Binding FiltroEquipo, UpdateSourceTrigger=PropertyChanged}"
                              IsTextSearchEnabled="False"
                              StaysOpenOnEdit="True"
                              ToolTip="Escriba para filtrar equipos por código, nombre o usuario"/>                    <!-- Día de Ejecución -->
                    <TextBlock Text="Día Ejecución:" Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" FontWeight="Bold"/>
                    <ComboBox ItemsSource="{Binding DiasDisponibles}"
                              SelectedValue="{Binding DiaEjecucion, UpdateSourceTrigger=PropertyChanged}"
                              SelectedValuePath="Valor"
                              DisplayMemberPath="Nombre"
                              Grid.Row="1" Grid.Column="1" Margin="0,4" Padding="8"
                              ToolTip="Día de la semana preferido para ejecutar el plan"/>                    <!-- Checklist de Tareas -->
                    <TextBlock Text="Lista de Tareas:" Grid.Row="2" Grid.Column="0" VerticalAlignment="Top" FontWeight="Bold" Margin="0,8,0,0"/>
                    <StackPanel Grid.Row="2" Grid.Column="1" Margin="0,4">
                        <!-- Área para agregar nueva tarea -->
                        <Border Background="#F8F9FA" BorderBrush="#DEE2E6" BorderThickness="1" CornerRadius="4" Padding="8" Margin="0,0,0,8">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox Text="{Binding NuevaTareaTexto, UpdateSourceTrigger=PropertyChanged}" 
                                         Grid.Column="0" Margin="0,0,8,0" Padding="6"
                                         ToolTip="Escriba la descripción de una nueva tarea"/>
                                <Button Content="+ Agregar" 
                                        Command="{Binding AgregarTareaCommand}"
                                        Grid.Column="1" Padding="12,6" 
                                        Background="#28A745" BorderBrush="#28A745" Foreground="White"
                                        ToolTip="Agregar nueva tarea al checklist"/>
                            </Grid>
                        </Border>
                        
                        <!-- Lista de tareas existentes -->
                        <Border BorderBrush="#DEE2E6" BorderThickness="1" CornerRadius="4" MaxHeight="200">
                            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                                <ItemsControl ItemsSource="{Binding TareasChecklist}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="White" 
                                                    BorderBrush="#DEE2E6" BorderThickness="0,0,0,1" Padding="8,6">                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    
                                                    <TextBox Text="{Binding Descripcion, UpdateSourceTrigger=PropertyChanged}" 
                                                             Grid.Column="0" Margin="0,0,8,0" 
                                                             BorderThickness="0" Background="Transparent"
                                                             VerticalAlignment="Center"
                                                             ToolTip="Editar descripción de la tarea"/>
                                                      <Button Content="✖"
                                                            Command="{Binding DataContext.EliminarTareaCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            CommandParameter="{Binding}"
                                                            Grid.Column="1" Padding="6,2" FontSize="10"
                                                            Background="#DC3545" BorderBrush="#DC3545" Foreground="White"
                                                            ToolTip="Eliminar esta tarea"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Border>
                    </StackPanel>                    <!-- Mensaje de estado -->
                    <TextBlock Text="{Binding StatusMessage}" Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2"
                               Margin="0,8,0,0" Foreground="#D32F2F" FontWeight="Bold" TextWrapping="Wrap"
                               Visibility="{Binding StatusMessage, Converter={StaticResource StringToVisibilityConverter}}"/>
                </Grid>

                <!-- Información adicional -->
                <Border Background="#F5F5F5" BorderBrush="#DDD" BorderThickness="1" CornerRadius="4" Padding="10" Margin="0,16,0,0">
                    <StackPanel>
                        <TextBlock Text="ℹ️ Información sobre Planes de Cronograma" FontWeight="Bold" Foreground="#555" Margin="0,0,0,8"/>                        <TextBlock Text="• Los planes definen actividades de mantenimiento que se ejecutan de forma programada" Foreground="#666" TextWrapping="Wrap" Margin="0,2"/>
                        <TextBlock Text="• El día de ejecución indica cuándo de la semana se debe realizar preferiblemente" Foreground="#666" TextWrapping="Wrap" Margin="0,2"/>
                        <TextBlock Text="• Puede agregar, editar y eliminar tareas del plan según sea necesario" Foreground="#666" TextWrapping="Wrap" Margin="0,2"/>
                        <TextBlock Text="• Las tareas se marcarán como completadas durante la ejecución del mantenimiento" Foreground="#666" TextWrapping="Wrap" Margin="0,2"/>
                        <TextBlock Text="• La descripción y responsable se pueden completar durante la ejecución del plan" Foreground="#666" TextWrapping="Wrap" Margin="0,2"/>
                        <TextBlock Text="• Solo el código del equipo es obligatorio para crear el plan" Foreground="#666" TextWrapping="Wrap" Margin="0,2"/>
                    </StackPanel>
                </Border>

                <!-- Botones -->
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
                    <Button Content="Cancelar" Name="BtnCancelar" Padding="16,8" Margin="0,0,10,0" MinWidth="100"
                            Background="#F5F5F5" BorderBrush="#DDD" Foreground="#333"
                            Style="{StaticResource {x:Type Button}}" Click="BtnCancelar_Click"/>                    <Button Command="{Binding CrearPlanCommand}" 
                            Padding="16,8" MinWidth="100" Background="#118938" BorderBrush="#118938" Foreground="White"
                            IsEnabled="{Binding IsSaving, Converter={StaticResource InverseBooleanConverter}}"
                            Style="{StaticResource {x:Type Button}}">
                        <Button.Content>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="📋" Margin="0,0,6,0" Visibility="{Binding IsSaving, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>
                                <TextBlock Text="⏳" Margin="0,0,6,0" Visibility="{Binding IsSaving, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                                <TextBlock Text="{Binding IsSaving, Converter={StaticResource BooleanToStringConverter}, ConverterParameter='Creando...|Crear Plan'}"/>
                            </StackPanel>
                        </Button.Content>
                    </Button>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Border>
</Window>
