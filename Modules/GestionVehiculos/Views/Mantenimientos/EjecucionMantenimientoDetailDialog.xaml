<Window x:Class="GestLog.Modules.GestionVehiculos.Views.Mantenimientos.EjecucionMantenimientoDetailDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:GestLog.Converters"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        xmlns:models="clr-namespace:GestLog.Modules.GestionVehiculos.Models.Enums"
        Title="Detalle de ejecución" WindowStartupLocation="CenterOwner"
        WindowStyle="None" AllowsTransparency="True" Background="Transparent" ResizeMode="CanResize"
        WindowState="Maximized" Style="{StaticResource ModalWindowBase}">

    <Window.Resources>
        <conv:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <conv:InverseBooleanConverter x:Key="InverseBooleanConverter" />
        <!-- items for estado enum -->
        <ObjectDataProvider x:Key="EstadoEjecucionValues" MethodName="GetValues" ObjectType="{x:Type sys:Enum}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="models:EstadoEjecucion" />
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
    </Window.Resources>

    <Grid x:Name="RootGrid" Background="#80000000" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
        <!-- Limitar anchura total para evitar que el contenido crezca demasiado al escribir -->
        <Border Background="{StaticResource SurfaceBrush}" CornerRadius="12" Padding="0"
                HorizontalAlignment="Center" VerticalAlignment="Center"
                BorderThickness="0" Effect="{StaticResource WindowShadow}"
                MaxWidth="900" MinWidth="500">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- header with icon, title and action buttons -->
                <Border Grid.Row="0" Background="{StaticResource PrimaryBrush}" CornerRadius="12,12,0,0" Padding="16,12" Effect="{StaticResource HeaderShadow}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Border Background="White" CornerRadius="8" Padding="8" Margin="0,0,12,0" Width="36" Height="36" Effect="{StaticResource SectionShadow}">
                                <TextBlock Text="ℹ️" FontSize="18" HorizontalAlignment="Center" VerticalAlignment="Center" />
                            </Border>
                            <StackPanel>
                                <TextBlock Text="Detalle de ejecución" FontFamily="Segoe UI" FontSize="18" FontWeight="SemiBold" Foreground="White" />
                                <TextBlock Text="Información completa de la ejecución" FontFamily="Segoe UI" FontSize="12" Foreground="White" Opacity="0.9" />
                                <Border Background="#1FFFFFFF" BorderBrush="#66FFFFFF" BorderThickness="1" CornerRadius="10"
                                        Padding="8,2" Margin="0,6,0,0"
                                        Visibility="{Binding IsEditing, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <TextBlock Text="✏️ Modo edición" FontFamily="Segoe UI" FontSize="11" FontWeight="SemiBold" Foreground="White" />
                                </Border>
                            </StackPanel>
                        </StackPanel>
                        <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,0,0">
                            <Button x:Name="BtnCloseHeader" Style="{StaticResource CloseButton}" Click="BtnClose_Click" ToolTip="Cerrar (Esc)" HorizontalAlignment="Right" VerticalAlignment="Center">
                                <Grid Width="14" Height="14">
                                    <Line X1="0" Y1="0" X2="14" Y2="14" Stroke="White" StrokeThickness="2" StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
                                    <Line X1="14" Y1="0" X2="0" Y2="14" Stroke="White" StrokeThickness="2" StrokeStartLineCap="Round" StrokeEndLineCap="Round"/>
                                </Grid>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>

                <ScrollViewer Grid.Row="1" Margin="24" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <!-- left column details -->
                        <StackPanel Grid.Column="0" Orientation="Vertical" Margin="0,0,24,0">
                            <TextBlock Text="Plan:" FontWeight="Bold" />
                            <Border Margin="0,0,0,16" Padding="12,10" Background="Transparent">
                                <TextBlock Text="{Binding PlanNombre}" Foreground="#1D1D1B" TextWrapping="Wrap" />
                            </Border>

                            <TextBlock Text="Fecha de ejecución:" FontWeight="Bold" />
                            <Border Margin="0,0,0,16" Padding="12,10" Background="Transparent"
                                    Visibility="{Binding IsEditing, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource InverseBooleanConverter}, ConverterParameter=Visibility}">
                                <TextBlock Text="{Binding FechaEjecucion, StringFormat={}{0:dd/MM/yyyy}}" Foreground="#1D1D1B" />
                            </Border>
                            <TextBox Text="{Binding FechaEjecucion, StringFormat={}{0:dd/MM/yyyy}, Mode=TwoWay}" Style="{StaticResource InputStyle}"
                                     Visibility="{Binding IsEditing, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BooleanToVisibilityConverter}}" />

                            <TextBlock Text="Kilometraje:" FontWeight="Bold" />
                            <Border Margin="0,0,0,16" Padding="12,10" Background="Transparent"
                                    Visibility="{Binding IsEditing, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource InverseBooleanConverter}, ConverterParameter=Visibility}">
                                <TextBlock Text="{Binding KMAlMomento}" Foreground="#1D1D1B" />
                            </Border>
                            <TextBox Text="{Binding KMAlMomento, Mode=TwoWay}" Style="{StaticResource InputStyle}"
                                     Visibility="{Binding IsEditing, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BooleanToVisibilityConverter}}" />

                            <TextBlock Text="Costo:" FontWeight="Bold" />
                            <Border Margin="0,0,0,16" Padding="12,10" Background="Transparent"
                                    Visibility="{Binding IsEditing, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource InverseBooleanConverter}, ConverterParameter=Visibility}">
                                <TextBlock Text="{Binding Costo, StringFormat={}{0:C2}}" Foreground="#1D1D1B" />
                            </Border>
                            <TextBox Text="{Binding Costo, StringFormat={}{0:C2}, Mode=TwoWay}" Style="{StaticResource InputStyle}"
                                     Visibility="{Binding IsEditing, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BooleanToVisibilityConverter}}" />
                        </StackPanel>
                        <!-- right column details -->
                        <StackPanel Grid.Column="1" Orientation="Vertical">
                            <TextBlock Text="Responsable:" FontWeight="Bold" />
                            <Border Margin="0,0,0,16" Padding="12,10" Background="Transparent"
                                    Visibility="{Binding IsEditing, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource InverseBooleanConverter}, ConverterParameter=Visibility}">
                                <TextBlock Text="{Binding ResponsableEjecucion}" Foreground="#1D1D1B" TextWrapping="Wrap" />
                            </Border>
                            <TextBox Text="{Binding ResponsableEjecucion, Mode=TwoWay}" Style="{StaticResource InputStyle}"
                                     Visibility="{Binding IsEditing, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BooleanToVisibilityConverter}}" />

                            <TextBlock Text="Proveedor:" FontWeight="Bold" />
                            <Border Margin="0,0,0,16" Padding="12,10" Background="Transparent"
                                    Visibility="{Binding IsEditing, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource InverseBooleanConverter}, ConverterParameter=Visibility}">
                                <TextBlock Text="{Binding Proveedor}" Foreground="#1D1D1B" TextWrapping="Wrap" />
                            </Border>
                            <TextBox Text="{Binding Proveedor, Mode=TwoWay}" Style="{StaticResource InputStyle}"
                                     Visibility="{Binding IsEditing, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BooleanToVisibilityConverter}}" />

                            <TextBlock Text="Estado:" FontWeight="Bold" />
                            <Border Margin="0,0,0,16" Padding="12,10" Background="Transparent"
                                    Visibility="{Binding IsEditing, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource InverseBooleanConverter}, ConverterParameter=Visibility}">
                                <TextBlock Text="{Binding EstadoEnum}" Foreground="#1D1D1B" />
                            </Border>
                            <ComboBox ItemsSource="{Binding Source={StaticResource EstadoEjecucionValues}}"
                                      SelectedItem="{Binding EstadoEnum, Mode=TwoWay}"
                                      Style="{StaticResource InputStyle}"
                                      Visibility="{Binding IsEditing, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BooleanToVisibilityConverter}}" />

                            <TextBlock Text="Factura:" FontWeight="Bold" />
                            <Border Margin="0,0,0,16" Padding="12,10" Background="Transparent">
                                <TextBlock Text="{Binding RutaFactura}" Foreground="#1D1D1B" TextWrapping="Wrap" />
                            </Border>

                            <TextBlock Text="Observaciones:" FontWeight="Bold" />
                            <Border Margin="0,0,0,16" Padding="12,10" Background="Transparent"
                                    Visibility="{Binding IsEditing, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource InverseBooleanConverter}, ConverterParameter=Visibility}">
                                <TextBlock Text="{Binding ObservacionesTecnico}" Foreground="#1D1D1B" TextWrapping="Wrap" />
                            </Border>
                            <TextBox Text="{Binding ObservacionesTecnico, Mode=TwoWay}" Style="{StaticResource InputStyle}"
                                     Visibility="{Binding IsEditing, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource BooleanToVisibilityConverter}}"
                                     TextWrapping="Wrap" Margin="0,0,0,8"
                                     AcceptsReturn="True" VerticalScrollBarVisibility="Auto" 
                                     MaxWidth="600" MinHeight="120" />
                        </StackPanel>
                    </Grid>
                </ScrollViewer>

                <Border Grid.Row="2" Background="#F5F5F5" Padding="12" CornerRadius="0,0,12,12" HorizontalAlignment="Stretch">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button x:Name="BtnEditFooter" Content="Editar" Style="{StaticResource PrimaryButtonStyle}" Width="100" Margin="0,0,8,0" Click="BtnEdit_Click" />
                        <Button x:Name="BtnCancelFooter" Content="Cancelar" Style="{StaticResource GhostButton}" Width="100" Margin="0,0,8,0" Click="BtnCancelFooter_Click" Visibility="Collapsed" />
                        <Button x:Name="BtnDeleteFooter" Content="Eliminar" Style="{StaticResource ButtonStyle}" Background="#C0392B" Foreground="White" Width="100" Click="BtnDelete_Click" />
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
</Window>